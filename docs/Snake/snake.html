<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake by Smapifan</title>
<style>
/* ===========================
   Grundlayout
   =========================== */
body {
  margin: 0;
  background: black;
  color: lime;
  font-family: monospace;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
}

h1 {
  margin-top: 10px;
  margin-bottom: 5px;
  text-shadow: 0 0 8px lime;
}

#scoreboard {
  text-align: center;
  font-size: 1.5rem;
  margin-bottom: 10px;
}

canvas {
  border: 3px solid lime;
  background: #000;
  display: block;
}

.ui {
  margin-top: 15px;
  display: flex;
  gap: 3vw;
  justify-content: center;
  align-items: center;
}

button {
  font-size: 6vw;
  padding: 1vw 2vw;
  border-radius: 10px;
  border: none;
  background: lime;
  color: black;
  font-weight: bold;
  cursor: pointer;
  user-select: none;
}

#gameOverScreen {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.9);
  color: lime;
  font-size: 2rem;
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
}

#gameOverScreen button {
  font-size: 1.5rem;
  margin-top: 20px;
  background: lime;
  color: black;
}

@media (min-width:800px){
  button { font-size: 2rem; }
}
</style>
</head>
<body>

<h1>Snake by Smapifan</h1>
<div id="scoreboard">
  Score: <span id="score">0</span><br>
  Highscore: <span id="highscore">0</span>
</div>

<canvas id="game"></canvas>

<div class="ui">
  <button id="left">LEFT</button>
  <button id="up">UP</button>
  <button id="down">DOWN</button>
  <button id="right">RIGHT</button>
</div>

<div id="gameOverScreen">
  <div>GAME OVER</div>
  <div style="margin-top:10px;font-size:1.3rem;">
    Your Score: <span id="finalScore">0</span>
  </div>
  <button id="restartBtn">Restart</button>
  <button id="menuBtn">Main Menu</button>
</div>

<!-- ===========================
     Audio Assets
     =========================== -->
<audio id="appleSound" src="https://smapifan.github.io/Smapifans-Arcade-Games/Snake/assets/Apple.mp3"></audio>
<audio id="gameOverSound" src="https://smapifan.github.io/Smapifans-Arcade-Games/Snake/assets/Game_over.mp3"></audio>
<audio id="bgMusic" src="https://smapifan.github.io/Smapifans-Arcade-Games/Snake/assets/Music.mp3" loop></audio>

<script>
// ===========================
// Grundvariablen
// ===========================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let box = 20;
let snake = [{ x: 10, y: 10 }];
let apple = { x: 15, y: 10 };
let direction = "RIGHT";
let score = 0;
let highscore = parseInt(localStorage.getItem("snake_highscore")) || 0;
let gameOver = false;
let musicStarted = false;

// Audio Elemente
const appleSound = document.getElementById("appleSound");
const gameOverSound = document.getElementById("gameOverSound");
const bgMusic = document.getElementById("bgMusic");

// Scoreboard initialisieren
document.getElementById("highscore").textContent = highscore;

// ===========================
// Spielfeld dynamisch quadratisch
// ===========================
function resizeCanvas() {
  const size = Math.min(window.innerWidth, window.innerHeight * 0.6);
  canvas.width = size - 20;
  canvas.height = size - 20;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

// ===========================
// Zeichnen der Schlange & Apfel
// ===========================
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Apfel zeichnen
  ctx.fillStyle = "red";
  ctx.fillRect(apple.x*box, apple.y*box, box, box);

  // Schlange zeichnen
  snake.forEach((segment,index)=>{
    ctx.fillStyle = index===0?"lime":"green";
    ctx.fillRect(segment.x*box, segment.y*box, box, box);
  });

  document.getElementById("score").textContent = score;
}

// ===========================
// Musik starten beim ersten Input
// ===========================
function startMusic(){
  if(!musicStarted){
    bgMusic.volume = 1.0;
    bgMusic.play();
    musicStarted = true;
  }
}

// ===========================
// Bewegung & Kollision
// ===========================
function moveSnake(){
  if(gameOver) return;

  let head = {...snake[0]};

  if(direction==="LEFT") head.x--;
  if(direction==="UP") head.y--;
  if(direction==="RIGHT") head.x++;
  if(direction==="DOWN") head.y++;

  // Randloop (wenn Schlange rausgeht, kommt sie wieder rein)
  head.x = (head.x + Math.floor(canvas.width/box)) % Math.floor(canvas.width/box);
  head.y = (head.y + Math.floor(canvas.height/box)) % Math.floor(canvas.height/box);

  // Kollision mit Körper
  for(let i=1;i<snake.length;i++){
    if(snake[i].x===head.x && snake[i].y===head.y){
      triggerGameOver();
      return;
    }
  }

  snake.unshift(head);

  // Apfel gegessen
  if(head.x===apple.x && head.y===apple.y){
    score++;

    // Musik leiser während Apfel-Sound
    const origVol = bgMusic.volume;
    bgMusic.volume = 0.2;
    appleSound.currentTime=0;
    appleSound.play();
    setTimeout(()=>{ bgMusic.volume=origVol; },300);

    if(score>highscore){
      highscore = score;
      localStorage.setItem("snake_highscore",highscore);
      document.getElementById("highscore").textContent = highscore;
    }

    // Neuer Apfel
    apple = {
      x: Math.floor(Math.random()*Math.floor(canvas.width/box)),
      y: Math.floor(Math.random()*Math.floor(canvas.height/box))
    };
  } else {
    snake.pop();
  }

  // Nach Score 20  nur Kopf behalten
  if(score>20){
    const head=snake[0];
    snake=[{x:head.x,y:head.y}];
  }
}

// ===========================
// Game Over
// ===========================
function triggerGameOver(){
  gameOver = true;
  bgMusic.pause();           // Musik stoppen
  gameOverSound.currentTime=0;
  gameOverSound.play();
  document.getElementById("finalScore").textContent = score;
  document.getElementById("gameOverScreen").style.display="flex";
}

// ===========================
// Spiel zurücksetzen
// ===========================
function resetGame(){
  gameOver=false;
  score=0;
  snake=[{x:10,y:10}];
  direction="RIGHT";
  document.getElementById("score").textContent=score;
  document.getElementById("gameOverScreen").style.display="none";
  bgMusic.play();  // Musik wieder starten
}

// ===========================
// Steuerung (Keyboard + Buttons)
// ===========================
document.addEventListener("keydown",e=>{
  startMusic(); // Musik starten beim ersten Input
  if(e.key==="ArrowLeft" && direction!=="RIGHT") direction="LEFT";
  if(e.key==="ArrowUp" && direction!=="DOWN") direction="UP";
  if(e.key==="ArrowRight" && direction!=="LEFT") direction="RIGHT";
  if(e.key==="ArrowDown" && direction!=="UP") direction="DOWN";
});

document.getElementById("up").onclick = ()=>{ startMusic(); if(direction!=="DOWN") direction="UP"; };
document.getElementById("down").onclick = ()=>{ startMusic(); if(direction!=="UP") direction="DOWN"; };
document.getElementById("left").onclick = ()=>{ startMusic(); if(direction!=="RIGHT") direction="LEFT"; };
document.getElementById("right").onclick = ()=>{ startMusic(); if(direction!=="LEFT") direction="RIGHT"; };

document.getElementById("restartBtn").onclick = resetGame;
document.getElementById("menuBtn");
menuBtn.onclick = () => {
  window.location.href = "https://smapifan.github.io/Smapifans-Arcade-Games/"; // goes back to your main menu
};

// ===========================
// Game Loop
// ===========================
setInterval(()=>{ moveSnake(); draw(); },120);
</script>
</body>
</html>